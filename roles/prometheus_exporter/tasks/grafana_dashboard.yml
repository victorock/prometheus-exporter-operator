# Manage GrafanaDashboard
---
- name: Convert grafanaDashboard.enabled boolean var into ansible grafana_dashboard_state state var for PrometheusExporter {{ meta.name }} on Namespace {{ meta.namespace }}
  set_fact:
    grafana_dashboard_state: "absent"
  when: grafana_dashboard.enabled is defined and grafana_dashboard.enabled|bool == false

- name: Manage GrafanaDashboard (if integreatly.org api-group exists) for PrometheusExporter {{ meta.name }} on Namespace {{ meta.namespace }}
  k8s:
    state: "{{ grafana_dashboard_state }}"
    definition: "{{ lookup('template', item.name) | from_yaml }}"
  when: item.api_exists | default(True)
  loop:
    - name: "grafana_dashboard/{{ type }}.yml.j2"
      api_exists: "{{ True if 'integreatly.org' in api_groups else False }}"
